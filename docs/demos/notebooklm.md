# 口袋 NotebookLM (Pocket NotebookLM)

口袋 NotebookLM 是基于 `Pocket Stack` 通过 `Vibe Coding` 的方式开发的一款个人知识库管理工具，对标 Google NotebookLM。它允许用户创建多个主题笔记本，在其中记录零散的笔记，并利用 AI 对笔记本内的内容进行对话、分析和结构化生成（Artifacts）。

## 核心功能

### 1. 笔记本管理 (Notebooks)
*   **多笔记本支持**: 用户可以创建多个独立的笔记本，用于区分不同的知识领域或项目。
*   **概览统计**: 列表页直观展示每个笔记本的笔记数量、AI 生成内容数量和对话次数。
*   **快捷操作**: 支持快速创建、编辑和删除笔记本。

### 2. 智能笔记 (Smart Notes)
*   **内容录入**: 支持 Markdown 格式的笔记录入。
*   **笔记管理**: 支持笔记的置顶、编辑和删除。
*   **侧边栏布局**: 笔记列表位于详情页侧边栏，支持折叠，方便在阅读和写作之间切换。

### 3. AI 对话 (AI Chat)
*   **上下文感知**: AI 助手能够“阅读”当前笔记本中的所有笔记内容，提供基于上下文的回答。
*   **沉浸式对话**: 类似于 ChatGPT 的对话体验，支持流式响应。
*   **转为笔记**: 遇到 AI 输出的有价值内容，支持一键“转为笔记”，自动保存到当前笔记本中，形成知识闭环。
*   **一键复制**: 支持快速复制 AI 回复的内容。

### 4. 结构化生成物 (Artifacts)
*   **生成器 (Builders)**: 系统内置多种生成器模板（如思维导图、总结报告、数据表格）。
*   **自动化生成**: 基于当前笔记本的笔记内容，一键生成结构化的产出物。
*   **可视化展示**:
    *   **思维导图**: 集成 Mermaid.js，自动渲染生成的思维导图。
    *   **Markdown**: 支持复杂的 Markdown 渲染，包括数学公式（KaTeX）。
    *   **表格**: 自动生成结构化数据表格。

### 5. 生成器管理 (Builder Management)
*   **管理员功能**: 仅管理员可访问。
*   **自定义模板**: 管理员可以创建和配置新的生成器。
*   **类型支持**: 目前支持三种类型：
    *   `mindmap`: 生成 Mermaid 格式的思维导图。
    *   `text`: 生成文本报告或总结。
    *   `table`: 生成对比表或数据表。
*   **Prompt 工程**: 为每个生成器配置专属的 System Prompt，控制生成效果。

## 使用指南

### 1. 创建笔记本与笔记
1.  进入 **笔记本** 页面，点击右上角“新建笔记本”。
2.  输入标题（如“项目A调研”），点击创建。
3.  进入笔记本详情页，点击左侧“新建笔记”按钮，输入笔记内容。

### 2. 与 AI 对话
1.  在笔记本详情页右侧，找到 AI 助手区域。
2.  输入你的问题，例如：“根据这些笔记，帮我总结一下项目的风险点。”
3.  AI 会分析左侧的所有笔记内容并给出回答。
4.  如果回答很有价值，点击消息下方的“转为笔记”图标，将其保存。

### 3. 生成 Artifacts
1.  在笔记本详情页右侧，切换到“生成物” (Artifacts) 标签页。
2.  点击“新建生成”，选择一个生成器（如“生成思维导图”）。
3.  系统将自动分析笔记并生成可视化图表或文档。
4.  生成的思维导图支持放大查看和交互。

### 4. 管理生成器 (管理员)
1.  进入 **笔记生成器管理** 页面。
2.  点击“新建生成器”，填写名称、提示词（Prompt）和类型。
3.  保存后，所有用户的笔记本中均可使用该生成器。

## 技术实现

### 数据模型 (PocketBase Collections)

*   **notebooks**: 存储笔记本元数据（标题、统计信息）。
*   **notebook_notes**: 存储具体的笔记内容，关联到 `notebooks`。
*   **notebook_artifacts**: 存储 AI 生成的结构化内容，关联到 `notebooks` 和 `notebook_builder`。
*   **notebook_builder**: 存储生成器模板（Prompt、类型），用于驱动 AI 生成。

### 前端组件架构

*   **NotebookList**: 笔记本列表页，负责 CRUD 操作。
*   **NotebookDetail**: 核心详情页，采用双栏/三栏布局。
    *   **NoteItem/NoteContent**: 笔记展示与编辑组件。
    *   **AiChatContainer**: 封装了 AI 对话逻辑，处理流式响应和消息记录。
    *   **Artifact**: 处理生成物的列表展示、生成请求和渲染（Markdown/Mermaid）。
*   **BuilderManager**: 生成器管理后台。

### 关键技术点

*   **React Markdown & Remark/Rehype**: 用于渲染富文本笔记和 AI 回复，支持 GFM、数学公式等。
*   **Mermaid.js**: 用于在前端动态渲染 AI 生成的思维导图代码。
*   **PocketBase SDK**: 处理所有数据持久化和实时订阅（如有）。
*   **React Router**: 嵌套路由设计，支持 `MainLayout` 下的独立页面结构。
